{"version":3,"sources":["../../src/utils/normalizeProduct.js"],"names":["normalizeProduct","data","color","size","getImages","viewType","variation","value","images","groups","imageGroups","filter","group","variationAttributes","id","values","reduce","memo","e","forEach","link","alt","Object","keys","map","src","getVariations","type","variations","find","attr","name","text","image","colors","sizes","c","thumbnails","media","full","thumbnail","length","undefined","img","push","productId","specs","key","indexOf","substring","join","url","productName","price","priceText","description","longDescription","quantity","raw"],"mappings":"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","sourcesContent":["export default function normalizeProduct(data, color, size) {\n  // Filter for images supporting type and variations\n  function getImages(viewType, variation, value) {\n    const images = {}\n    const groups = data.imageGroups || []\n    groups\n      .filter(group => {\n        if (group.viewType !== viewType) return false\n        if (variation) {\n          return (\n            group.variationAttributes &&\n            group.variationAttributes[0].id === variation &&\n            group.variationAttributes[0].values[0].value === value\n          )\n        }\n        return true\n      })\n      .reduce((memo, e) => [...memo, ...e.images], [])\n      .forEach(({ link, alt }) => {\n        images[link] = alt\n      })\n    return Object.keys(images).map(src => ({ src, alt: images[src] }))\n  }\n\n  function getVariations(type) {\n    if (!data.variationAttributes) {\n      return []\n    }\n    const variations = data.variationAttributes.find(attr => attr.id === type)\n    if (!variations) return []\n    return variations.values.map(({ name, value }) => {\n      const id = value\n      return {\n        id,\n        text: name,\n        image: getImages('swatch', type, id)[0],\n      }\n    })\n  }\n\n  const colors = getVariations('color')\n  const sizes = getVariations('size')\n\n  colors.forEach(c => {\n    const thumbnails = getImages('medium', 'color', c.id)\n    c.media = {\n      full: getImages('large', 'color', c.id),\n      thumbnails,\n      thumbnail: thumbnails.length ? thumbnails[0] : undefined,\n    }\n  })\n\n  const media = {\n    full: getImages('large'),\n    thumbnails: getImages('medium'),\n  }\n\n  if (data.image) {\n    const img = {\n      src: data.image.link,\n      alt: data.image.alt,\n      type: 'image',\n      // magnify?\n    }\n    media.full.push(img)\n    media.thumbnails.push(img)\n  }\n\n  const id = data.id || data.productId\n\n  const specs = Object.keys(data)\n    .filter(key => key.indexOf('c_') === 0)\n    .map(key => {\n      return `${key.substring(2)}: ${data[key]}`\n    })\n    .join('\\n')\n\n  return {\n    id,\n    url: `/p/${id}`,\n    name: data.name || data.productName,\n    price: data.price,\n    priceText: `$${data.price}.00`, // n/a\n    // rating: n/a\n    description: data.longDescription,\n    media,\n    thumbnail: media.thumbnails[0] || {},\n    colors,\n    sizes,\n    specs,\n    quantity: data.quantity || 1,\n    // TODO: Remove later\n    raw: data,\n  }\n}\n"],"file":"normalizeProduct.js"}